# 实验室设备管理系统 E-R 图

## 实体关系图 (Entity-Relationship Diagram)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          实验室设备管理系统 E-R 图                              │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                                实体 (Entities)                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 1. 设备 (Equipment)                                                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 主键: id (INTEGER PRIMARY KEY AUTOINCREMENT)                                  │
│ 属性:                                                                         │
│   - name (TEXT NOT NULL)                    // 设备名称                       │
│   - device_model (TEXT)                     // 设备型号                       │
│   - serial_number (TEXT UNIQUE)             // 序列号（唯一）                 │
│   - purchase_date (TEXT)                    // 采购日期                       │
│   - price (REAL)                           // 价格                           │
│   - quantity (INTEGER)                      // 库存数量                       │
│   - location (TEXT)                         // 存放地点                       │
│   - status (TEXT)                          // 状态（正常/维修中/已借出/报废） │
│   - threshold (INTEGER)                     // 预警阈值                       │
│   - scrap_time (TEXT)                      // 报废时间                       │
│   - scrap_reason (TEXT)                    // 报废原因                       │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 2. 借还记录 (Borrow_Return)                                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 主键: id (INTEGER PRIMARY KEY AUTOINCREMENT)                                  │
│ 外键: equipment_id (INTEGER) -> Equipment.id                                  │
│ 属性:                                                                         │
│   - borrower_name (TEXT)                    // 借用人姓名                     │
│   - borrow_date (TEXT)                      // 借用日期                       │
│   - return_date (TEXT)                      // 归还日期                       │
│   - purpose (TEXT)                          // 用途                           │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 3. 维修记录 (Maintenance)                                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 主键: id (INTEGER PRIMARY KEY AUTOINCREMENT)                                  │
│ 外键: equipment_id (INTEGER) -> Equipment.id                                  │
│ 属性:                                                                         │
│   - maintenance_date (TEXT)                  // 报修日期                       │
│   - issue_description (TEXT)                 // 问题描述                       │
│   - repair_description (TEXT)                // 维修描述                       │
│   - cost (REAL)                             // 维修费用                       │
│   - technician (TEXT)                       // 维修人员                       │
│   - completion_date (TEXT)                  // 完成日期                       │
│   - status (TEXT)                          // 状态（待维修/维修中/已完成）    │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 4. 维修视图 (v_maintenance_full)                                             │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 视图定义:                                                                     │
│ SELECT m.id, e.name AS equipment_name, e.serial_number,                      │
│        m.maintenance_date, m.issue_description, m.repair_description,        │
│        m.cost, m.technician, m.completion_date, m.status                     │
│ FROM maintenance m                                                            │
│ LEFT JOIN equipment e ON m.equipment_id = e.id                               │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              关系 (Relationships)                              │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 1. Equipment (1) ─────── (N) Borrow_Return                                   │
│    关系: 一个设备可以有多个借还记录                                           │
│    约束: 外键约束 equipment_id -> Equipment.id                               │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 2. Equipment (1) ─────── (N) Maintenance                                     │
│    关系: 一个设备可以有多个维修记录                                           │
│    约束: 外键约束 equipment_id -> Equipment.id                               │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              业务规则 (Business Rules)                         │
└─────────────────────────────────────────────────────────────────────────────────┘

1. 设备状态管理:
   - 正常: 设备可用，库存 > 0
   - 维修中: 设备正在维修，不可借用
   - 已借出: 设备库存 = 0，但未报废
   - 报废: 设备永久不可用

2. 库存管理:
   - 借用设备时，库存 -1
   - 归还设备时，库存 +1
   - 库存为0时，状态自动设为"已借出"
   - 归还后，状态自动设为"正常"

3. 维修流程:
   - 设备报修时，状态设为"维修中"
   - 维修完成后，状态恢复为"正常"
   - 报废设备不能进行维修

4. 数据完整性:
   - 序列号必须唯一
   - 外键约束确保数据一致性
   - 借用记录必须有设备ID和借用人信息

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              索引 (Indexes)                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

1. Equipment表:
   - PRIMARY KEY (id)
   - UNIQUE (serial_number)
   - INDEX (name, device_model) - 用于搜索
   - INDEX (status) - 用于状态筛选

2. Borrow_Return表:
   - PRIMARY KEY (id)
   - FOREIGN KEY (equipment_id)
   - INDEX (borrower_name) - 用于借用人搜索
   - INDEX (borrow_date) - 用于日期筛选

3. Maintenance表:
   - PRIMARY KEY (id)
   - FOREIGN KEY (equipment_id)
   - INDEX (status) - 用于状态筛选
   - INDEX (maintenance_date) - 用于日期筛选

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              视图 (Views)                                     │
└─────────────────────────────────────────────────────────────────────────────────┘

v_maintenance_full: 维修记录完整视图
- 关联设备表和维修记录表
- 显示设备名称和序列号
- 便于维修管理界面使用

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              功能模块 (Modules)                               │
└─────────────────────────────────────────────────────────────────────────────────┘

1. 设备管理模块 (EquipmentWidget):
   - 设备增删改查
   - 设备状态管理
   - 报废信息查看
   - 设备统计

2. 借还管理模块 (BorrowReturnWidget):
   - 设备借用
   - 设备归还
   - 借还记录查询
   - 借用排行

3. 维修管理模块 (MaintenanceWidget):
   - 维修记录添加
   - 维修状态更新
   - 维修完成处理
   - 设备报废

4. 库存管理模块 (InventoryWidget):
   - 库存检查
   - 预警管理

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              数据流 (Data Flow)                               │
└─────────────────────────────────────────────────────────────────────────────────┘

1. 设备借用流程:
   Equipment(库存检查) → Borrow_Return(添加记录) → Equipment(更新库存和状态)

2. 设备归还流程:
   Borrow_Return(更新归还日期) → Equipment(增加库存和恢复状态)

3. 设备维修流程:
   Equipment(状态检查) → Maintenance(添加记录) → Equipment(状态设为维修中)

4. 维修完成流程:
   Maintenance(更新完成状态) → Equipment(状态恢复为正常)

5. 设备报废流程:
   Maintenance(报废操作) → Equipment(状态设为报废，记录报废信息) 